<div class="chart-section" [ngClass]="{'noChart': total < 10}">
  <div class="return">
    <div (click)="returnToMain()" class="return-item">
      <i></i>
      <div class="return-text">Main</div>
    </div>
  </div>
  <ng-container>
    <!--charts will be displayed when test has been performed more than 10 times-->
    <div *ngIf="total >= 10" class="charts">
      <div class="behave-charts">
        <!-- Highchart -->
        <behave-chart-desktop-steps *ngIf="results" [data]="results"></behave-chart-desktop-steps>
      </div>
    </div>
    <!-- will be shown if the test has not been performed 10 times-->
    <div *ngIf="total < 10" class="no-chart">
      <img src="assets/img/poster_2.svg" alt="shown when there is no charts">
      <p>This screen shows the results of your testruns. <br><br> Once you have more then 10 results, co.meta will show you a beautiful linechart with execution times and more.</p>
    </div>
    <!-- Mobile Header -->
    <div class="mobile-info header">
      <div class="steps">Steps #</div>
      <div class="browser">Browsers</div>
      <div class="last_test">Last test</div>
    </div>
    <!-- Mobile Stats -->
    <div class="mobile-info" *ngIf="results[0] as lastRun">
      <div class="steps">{{ lastRun.total}}</div>
      <div class="steps">{{ 1 }}</div>
      <div class="steps last-result-status" *ngLet="lastRun.success as passed" [ngClass]="passed ? 'success' : 'failed'">{{ passed ? 'OK' : 'NOK' }}</div>
    </div>
  </ng-container>
</div>

<mtx-grid [data]="results"
          [columns]="columns"
          [sortOnFront]="true"
          sortActive="result_date"
          sortDirection="desc"
          [sortDisableClear]="true"
          [sortDisabled]="false"
          [showToolbar]="true"
          [showColumnMenuButton]="true"
          [columnMenuButtonType]="'stroked'"
          [columnMenuButtonIcon]="'view_column'"
          [length]="total"
          [loading]="isLoading"
          [pageOnFront]="false"
          [pageIndex]="query.page"
          [pageSize]="query.size"
          [pageSizeOptions]="[10, 25, 50, 100, 200, 500]"
          (rowClick)="openContent($event.rowData)"
          [cellTemplate]="{status: statusTpl, result_date: dateTpl, execution_time: timeTpl, pixel_diff: pixelTpl, browser: browserTpl}"
          [noResultTemplate]="noResultTpl"
          [showPaginator]="showPagination"
          [toolbarTemplate]="toolbarTpl"
          (page)="updateData($event)">
</mtx-grid>

<!-- ROW TEMPLATES -->
<ng-template #statusTpl let-row let-index="index" let-col="colDef">
  <div class="cell status" *ngLet="row.status == 'Success' as passed">
    <!-- Status box -->
    <div class="status-box passed" stopPropagation [matMenuTriggerFor]="runStatus" *ngIf="passed; else failed">
        Passed</div>
    <ng-template #failed>
        <div class="status-box failed" stopPropagation [matMenuTriggerFor]="runStatus">Failed</div>
    </ng-template>
    <!-- Override feature result status -->
    <mat-menu #runStatus="matMenu">
      <div class="menu-header">Override run status:</div>
      <button (click)="setResultStatus(row, 'Success')" mat-menu-item>
          <div class="status-option passed">Passed</div>
      </button>
      <button (click)="setResultStatus(row, 'Failed')" mat-menu-item>
          <div class="status-option failed">Failed</div>
      </button>
      <mat-divider></mat-divider>
      <button (click)="setResultStatus(row, '')" mat-menu-item>
          <div class="status-option default">Default</div>
      </button>
    </mat-menu>
  </div>
</ng-template>

<ng-template #dateTpl let-row let-index="index" let-col="colDef">
  <span>{{ row.result_date | amParse | amDateFormat:'MMMM d yyyy, HH:mm' }}</span>
</ng-template>

<ng-template #timeTpl let-row let-index="index" let-col="colDef">
  <span>{{ row.execution_time | secondsToHumanReadable }}</span>
</ng-template>

<ng-template #pixelTpl let-row let-index="index" let-col="colDef">
  <span>{{ row.pixel_diff | pixelDifference }}</span>
</ng-template>

<ng-template #browserTpl let-row let-index="index" let-col="colDef">
  <i class="browser-icon aligned-center" [attr.data-browser-version]="row.browser.browser_version" matTooltipPosition="above" [matTooltip]="row.browser.browser | titlecase"
            [style.backgroundImage]="row.browser.browser | browserIcon"></i>
</ng-template>

<!-- TOOLBAR TEMPLATE -->
<ng-template #toolbarTpl>
  <div class="custom_toolbar">
    
  </div>
</ng-template>

<!-- NO RESULTS TEMPLATE -->
<ng-template #noResultTpl>
  <div class="no-tests">
    <p>Please execute your first feature clicking the blue run-button. </p>
    <br />
    <p class="greyed">If you just added a feature and it's executing now you will have to wait until it's finished.</p>
    <br />
    <p class="greyed">These results are reloaded automatically.</p>
  </div>
</ng-template>