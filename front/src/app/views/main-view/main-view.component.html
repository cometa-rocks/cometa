<div class="current_filters">
  <cometa-feature-titles></cometa-feature-titles>
  <cometa-feature-actions></cometa-feature-actions>
</div>

<div class="chart-section" [ngClass]="{'noChart': total < 10}">
  <div class="return">
    <div (click)="returnToMain()" class="return-item">
      <i></i>
      <div class="return-text">Main</div>
    </div>
  </div>
  <ng-container>
    <!--charts will be displayed when test has been performed more than 10 times-->
    <div *ngIf="total >= 10" class="charts">
      <div class="behave-charts">
        <!-- Highchart -->
        <behave-chart-desktop-steps *ngIf="results" [data]="results"></behave-chart-desktop-steps>
      </div>
    </div>
    <!-- will be shown if the test has not been performed 10 times-->
    <div *ngIf="total < 10" class="no-chart">
      <img src="assets/img/poster_2.svg" alt="shown when there is no charts">
      <p>This screen shows the results of your testruns. <br><br> Once you have more then 10 results, co.meta will show you a beautiful linechart with execution times and more.</p>
    </div>
    <!-- Mobile Header -->
    <div class="mobile-info header">
      <div class="steps">Steps #</div>
      <div class="browser">Browsers</div>
      <div class="last_test">Last test</div>
    </div>
    <!-- Mobile Stats -->
    <div class="mobile-info" *ngIf="results[0] as lastRun">
      <div class="steps">{{ lastRun.total}}</div>
      <div class="steps">{{ 1 }}</div>
      <div class="steps last-result-status" *ngLet="lastRun.success as passed" [ngClass]="passed ? 'success' : 'failed'">{{ passed ? 'OK' : 'NOK' }}</div>
    </div>
  </ng-container>
</div>

<mtx-grid [data]="results"
          [columns]="columns"
          [columnResizable]="true"
          [rowHover]="true"
          [rowStriped]="true"
          [rowSelectable]="true"
          [length]="total"
          [loading]="isLoading"
          [pageOnFront]="false"
          [pageIndex]="query.page"
          [pageSize]="query.size"
          [pageSizeOptions]="[10,50,100]"
          (rowClick)="openContent($event.rowData)"
          [cellTemplate]="{status: statusTpl, result_date: dateTpl}"
          (page)="getNextPage($event)">
</mtx-grid>

<!-- ROW TEMPLATES -->
<ng-template #statusTpl let-row let-index="index" let-col="colDef">
  {{ row.success ? "Passed" : "Failed" }}
</ng-template>

<ng-template #dateTpl let-row let-index="index" let-col="colDef">
  {{ row.result_date | amParse | amDateFormat:'MMMM d yyyy, HH:mm' }}
</ng-template>

<!--
<div class="table_rows">
  <network-paginated-list  *ngLet="featureId$ | async as featureId"
    [listId]="'runs_' + featureId"
    [endpointUrl]="featureRunsUrl$ | async"
    [headerTemplate]="headTemplate"
    [noItemsTemplate]="noItemsFound"
    [injectIndex]="false"
    [useSkeletons]="true"
    skeletonsHeight="50px"
    [showHeaderOnNoResults]="true"
    trackByKey="feature_result_id"
    [itemTemplate]="listItem">
    <ng-template #listItem let-item>
      <cometa-feature-run [test]="item"></cometa-feature-run>
    </ng-template>
    <ng-template #headTemplate>
        <cometa-main-view-header></cometa-main-view-header>
    </ng-template>
    <ng-template #noItemsFound>
      <div class="no-tests">
        <p>Please execute your first feature clicking the blue run-button. </p>
        <br />
        <p class="greyed">If you just added a feature and it's executing now you will have to wait until it's finished.</p>
        <br />
        <p class="greyed">These results are reloaded automatically.</p>
      </div>
    </ng-template>
  </network-paginated-list>
</div>
-->