<draggable-window></draggable-window>
<form [formGroup]="editMobileForm">
  <ng-container>
    <h2 mat-dialog-title>Edit Mobile Device</h2>
  </ng-container>
  <mat-dialog-content>
    <mat-accordion multi>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <span>Install APKs</span>
          </mat-panel-title>
          <mat-panel-description class="mat-expansion-panel-header-description ng-tns-c95-66">
            Department: {{ data.department_name }} - {{ data.uploadedAPKsList.length }} APKs
          </mat-panel-description>
        </mat-expansion-panel-header>
        <div class="edit-feature-info">
          <mat-form-field appearance="fill" class="edit-app">
            <mat-label>Application</mat-label>
            <mat-select formControlName="selectedApp" (selectionChange)="onSelectApp($event)">
              <mat-option
                *ngFor="let apk of data.uploadedAPKsList"
                [value]="apk"
                [class.selected-apk]="isApkSelected(apk)">
                {{ apk.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div *ngIf="selectedApks.length === 0" class="no-apks-message">
          <p>No APKs selected yet. Please select an APK to add it here.</p>
        </div>
        <div class="selected-apks">
          <mat-chip-grid #chipGrid aria-label="Selected APKs">
            <mat-chip-row
              *ngFor="let apk of selectedApks; let i = index"
              (removed)="removeSelectedApk(apk, i)"
              [editable]="false"
              [aria-description]="'press enter to remove ' + apk.name">
              <span
                class="chip-text"
                matTooltip="{{ apk.name }}"
                matTooltipPosition="above">
                {{ apk.name }}
              </span>
              <button matChipRemove [attr.aria-label]="'remove ' + apk.name">
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
          </mat-chip-grid>
        </div>
      </mat-expansion-panel>

      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <span>Installed APKs</span>
          </mat-panel-title>
          <mat-panel-description>
            {{ data.uploadedAPKsList.length }} APKs Installed
          </mat-panel-description>
        </mat-expansion-panel-header>

        <div *ngIf="data.uploadedAPKsList.length === 0" class="no-apks-message">
          <p>No APKs installed yet.</p>
        </div>

        <div class="installed-apks">
          <mat-chip-grid #chipGrid aria-label="Installed APKs">
            <mat-chip-row
              *ngFor="let apk of data.uploadedAPKsList; let i = index"
              [editable]="false">
              <span class="chip-text" matTooltip="{{ apk.name }}" matTooltipPosition="above">
                {{ apk.name }}
              </span>
            </mat-chip-row>
          </mat-chip-grid>
        </div>
      </mat-expansion-panel>

      <!-- Sharing Settings Panel -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <span>Sharing Emulator</span>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="sharing-settings">
          <mat-slide-toggle
            formControlName="shared"
            class="mat-slider-toggle"
            id="isShared_{{ data.mobile.mobile_id }}"
            color="primary">
            <span>Share this mobile with others</span>
          </mat-slide-toggle>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button (click)="closeDialog()">Cancel</button>
    <button mat-flat-button color="primary" (click)="saveChanges()">Save</button>
  </mat-dialog-actions>
</form>
