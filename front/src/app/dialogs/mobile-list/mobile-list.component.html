<div *ngIf="!isLoading">
  <div *ngIf="!configValueBoolean; else boughtLicense">
    <div *ngIf="isDialog; else notDialog"
      [ngClass]="{ 'mobile-emulator-panel': !configValueBoolean, 'bought-license-panel': configValueBoolean }">

      <div class="license-info-container">
        <mat-dialog-content>
          <div class="containerContract">
            <img class="mobileContactImage" src="assets/img/contract_mobile_device.svg" alt="Image contract mobile device"/>
            <div class="containerExplanations">
              <h2 class="license-title">Mobile Testing License</h2>
              <p class="license-text">
                Unlock the full potential of mobile testing with our premium license
              </p>
              
              <div class="features-list">
                <div class="feature-item">
                  <mat-icon class="feature-icon">devices</mat-icon>
                  <span>Access to multiple Android devices and versions</span>
                </div>
                <div class="feature-item">
                  <mat-icon class="feature-icon">screen_share</mat-icon>
                  <span>Real-time device inspection and control</span>
                </div>
                <div class="feature-item">
                  <mat-icon class="feature-icon">security</mat-icon>
                  <span>Secure and isolated testing environments</span>
                </div>
                <div class="feature-item">
                  <mat-icon class="feature-icon">group</mat-icon>
                  <span>Team collaboration features</span>
                </div>
              </div>

              <p class="contactMail">
                Get in touch with our support team:
              </p>

              <div class="features-list">
                <div class="feature-item">
                  <mat-icon class="feature-icon">mail</mat-icon>
                  <a href="mailto:support&#64;cometa.rocks" class="support-link">   
                    support&#64;cometa.rocks
                  </a>
                </div>
                <div class="feature-item">
                  <mat-icon class="feature-icon">phone</mat-icon>
                  <a href="tel:+1234567890" class="phone-link">
                    +34 717 10 26 03
                  </a>
                </div>
                <div class="feature-item">
                  <mat-icon class="feature-icon">phone</mat-icon>
                  <a href="tel:+1234567890" class="phone-link">
                    +49 711 89 46 70 29
                  </a>
                </div>
              </div>

            </div>
          </div>
        </mat-dialog-content>
        <mat-dialog-actions class="dialog-actions-container">
          <button mat-stroked-button color="warn" mat-dialog-close>Close</button>
        </mat-dialog-actions>
      </div>
    </div>
    <ng-template #notDialog>
      <div class="license-info-container-not-dialog">
        <div class="containerContract">
          <img class="mobileContactImage" src="assets/img/contract_mobile_device.svg" alt="Image contract mobile device"/>
          <div class="containerExplanations">
            <h2 class="license-title">Mobile Testing License</h2>
            <p class="license-text">
              Unlock the full potential of mobile testing with our premium license
            </p>
            
            <div class="features-list">
              <div class="feature-item">
                <mat-icon class="feature-icon">devices</mat-icon>
                <span>Access to multiple Android devices and versions</span>
              </div>
              <div class="feature-item">
                <mat-icon class="feature-icon">screen_share</mat-icon>
                <span>Real-time device inspection and control</span>
              </div>
              <div class="feature-item">
                <mat-icon class="feature-icon">security</mat-icon>
                <span>Secure and isolated testing environments</span>
              </div>
              <div class="feature-item">
                <mat-icon class="feature-icon">group</mat-icon>
                <span>Team collaboration features</span>
              </div>
            </div>

            <p class="contactMail">
              Get in touch with our support team:
            </p>

            <div class="features-list">
              <div class="feature-item">
                <mat-icon class="feature-icon">mail</mat-icon>
                <a href="mailto:support&#64;cometa.rocks" class="support-link">   
                  support&#64;cometa.rocks
                </a>
              </div>
              <div class="feature-item">
                <mat-icon class="feature-icon">phone</mat-icon>
                <a href="tel:+1234567890" class="phone-link">
                  +34 717 10 26 03
                </a>
              </div>
              <div class="feature-item">
                <mat-icon class="feature-icon">phone</mat-icon>
                <a href="tel:+1234567890" class="phone-link">
                  +49 711 89 46 70 29
                </a>
              </div>
            </div>
          </div>
        </div>  
      </div>  
    </ng-template>
  </div>

  <ng-template #boughtLicense>
    <div *ngIf="isDialog; else notDialog">
      <draggable-window></draggable-window>
      <ng-container>
        <h2 class="dialog-title">Mobile Devices</h2>
      </ng-container>
      <mat-dialog-actions class="dialog-header">
        <!-- <h3 class="dialog-title">Mobile Devices</h3> -->
        <!-- <div class="dialog-draggable-wrapper">
          <draggable-window style="margin-top: -23px !important; margin-right: 10px;"></draggable-window>
        </div> -->
      </mat-dialog-actions>

      <mat-dialog-content class="scrollable-content">
          <!-- <h2 mat-dialog-title>Mobile Devices</h2> -->
          <!-- Available Devices -->
          <div class="devices">
            <!-- <div *ngIf="container.length > 0"> -->
              <!-- Mobile selection section -->
              <div class="mobile-selector-box">
                <div class="mobiles">
                  <!-- Iterate over mobile containers list -->
                  <div class="mobile" *ngFor="let mobile of mobiles">
                    <div
                      *ngLet="
                        isThisMobileContainerRunning(
                          mobile.mobile_id
                        ) as runningContainer
                      ">
                      <div class="container-buttons">
                        <div
                          class="container-inspect-left"
                          *ngIf="runningContainer; else notRunningTemplate">
                          <div
                            (click)="inspectMobile(runningContainer, mobile)"
                            mat-raised-button
                            class="start-stop-inpect-buttons"
                            [disabled]="runningContainer.isTerminating"

                            [matTooltip]="'mobile_list.inspect_emulator' | translate" matTooltipPosition="above">
                            <span class="inspect-text">Inspect</span>
                            <i class="material-icons icon-on-hover">visibility</i>
                          </div>
                          <div class="hideShadow"></div>
                        </div>
                        <div
                          class="container-novnc-left"
                          *ngIf="runningContainer; else notRunningTemplate">
                          <div
                            (click)="noVNCMobile(runningContainer, mobile)"
                            mat-raised-button
                            class="start-stop-inpect-buttons"

                            [matTooltip]="'mobile_list.inspect_novnc' | translate"
                            matTooltipPosition="above">
                            <span class="inspect-text">noVNC</span>
                            <i class="material-icons icon-on-hover">visibility</i>
                          </div>
                          <div class="hideShadow"></div>
                        </div>
                        <div
                          class="border-left-close"
                          *ngIf="runningContainer; else notRunningTemplate">
                          <div
                            [matTooltip]="'mobile_list.close_emulator' | translate"
                            matTooltipPosition="above"
                            mat-raised-button
                            color="warn"
                            class="close"
                            (click)="!runningContainer?.isTerminating && terminateMobile(runningContainer)"
                            [ngClass]="{ 'spinner-active': runningContainer?.isTerminating }">
                            <ng-container
                              *ngIf="!runningContainer?.isTerminating; else showSpinner">
                              <mat-icon class="close-icon">close</mat-icon>
                            </ng-container>

                            <ng-template #showSpinner>
                              <mat-spinner
                                class="spinner"
                                color="accent"
                                diameter="16">
                              </mat-spinner>
                            </ng-template>
                          </div>
                        </div>
                        <div class="border-left-start-restart"
                          [ngClass]="{ 'disabled-button-border': !selectedDepartment || !selectedDepartment.id }"
                          *ngIf="!runningContainer">
                          <div
                            (click)="startMobile(mobile.mobile_id)"
                            [disabled]="!selectionsDisabled"
                            [ngClass]="{ 'disabled-button': !selectedDepartment || !selectedDepartment.id }"
                            mat-raised-button
                            color="primary"
                            class="start">
                            Start
                          </div>
                        </div>
                        <ng-container *ngIf="runningContainer">
                          <div class="skewed-button-container"
                            [ngClass]="{
                              'restart-bg': runningContainer.service_status === 'Stopped' || runningContainer.service_status === 'Restarting',
                              'pause-bg': runningContainer.service_status === 'Running' || runningContainer.service_status === 'Stopping'
                            }">

                            <div
                              mat-raised-button
                              class="skewed-button"
                              (click)="handleMobileState(runningContainer)"
                              [disabled]="runningContainer.service_status === 'Restarting' || runningContainer.service_status === 'Stopping'"
                              [matTooltip]="
                              runningContainer.service_status === 'Running' ? 'Click to pause' :
                              (runningContainer.service_status === 'Stopped' ? 'Click to restart' : '')"
                              matTooltipPosition="above">

                              <ng-container *ngIf="runningContainer.service_status === 'Stopping' || runningContainer.service_status === 'Restarting'; else showIcon">
                                <mat-spinner
                                  class="spinnerPause"
                                  [color]="runningContainer.service_status === 'Restarting' ? 'warn' : 'primary'"
                                  diameter="16">
                                </mat-spinner>
                              </ng-container>

                              <ng-template #showIcon>
                                <i class="material-icons skewed-content">
                                  {{ runningContainer.service_status === 'Running' ? 'pause' : 'play_arrow' }}
                                </i>
                                <span class="skewed-content-span">
                                  {{ runningContainer.service_status === 'Running' ? 'Pause' : 'Restart' }}
                                </span>
                              </ng-template>

                            </div>
                          </div>
                        </ng-container>

                      </div>

                       <!-- Button more vert (modify etc) -->
                       <div class="mobile-details">
                        <button
                          [matTooltip]="'mobile_list.emulator_options' | translate"
                          matTooltipPosition="after"
                          class="emulatorOptions"
                          mat-icon-button
                          [matMenuTriggerFor]="emulatorOptions">
                          <mat-icon>more_vert</mat-icon>
                        </button>

                        <mat-menu #emulatorOptions="matMenu">
                          <!-- Start -->
                          <button
                            (click)="startMobile(mobile.mobile_id)"
                            class="startMenu"
                            [disabled]="runningContainer"
                            [matTooltip]="'tooltips.run_feature' | translate"
                            matTooltipPosition="after"
                            mat-menu-item>
                            <mat-icon>play_circle_filled</mat-icon>
                            <span>Start</span>
                          </button>

                          <!-- Restart -->
                          <button
                            (click)="restartMobile(runningContainer)"
                            class="restartMenu"
                            [disabled]="
                              runningContainer?.service_status === 'Running' ||
                              runningContainer?.service_status === 'Restarting' ||
                              runningContainer?.service_status === 'Stopping' ||
                              !runningContainer"
                            mat-menu-item>
                            <img class="iconImgRestart" alt="Not started icon" src="assets/not_started.svg">
                            <span>Restart</span>
                          </button>

                          <!-- Pause -->
                          <button
                            (click)="pauseMobile(runningContainer)"
                            class="pauseMenu"
                            [disabled]="
                              runningContainer?.service_status === 'Stopped' ||
                              runningContainer?.service_status === 'Stopping' ||
                              runningContainer?.service_status === 'Restarting' ||
                              !runningContainer"
                            mat-menu-item>
                            <mat-icon>pause_circle_filled</mat-icon>
                            <span>Pause</span>
                          </button>

                          <mat-divider></mat-divider>

                          <!-- Modify -->
                          <button
                            [disabled]="runningContainer?.service_status !== 'Running'"
                            [matTooltip]="(runningContainer?.service_status !== 'Running'
                            ? 'mobile_list.modify_emulator_not_started'
                            : 'mobile_list.modify_emulator_started') | translate"
                            matTooltipPosition="after"
                            (click)="openModifyEmulatorDialog(mobile, runningContainer)"
                            class="modifyMenu"
                            mat-menu-item>
                            <mat-icon>edit</mat-icon>
                            <span>Modify</span>
                          </button>

                          <mat-divider></mat-divider>

                          <!-- Close -->
                          <button
                            (click)="terminateMobile(runningContainer)"
                            class="closeMenu"
                            [disabled]="!runningContainer"
                            mat-menu-item>
                            <mat-icon class="close-icon">cancel</mat-icon>
                            <span class="modifySpan">Close</span>
                          </button>
                        </mat-menu>

                        <div class="mobile-information">
                          <div class="emulator-info">
                            <i class="material-icons">adb</i>
                            <strong>Mobile Name:</strong>
                            {{ mobile.mobile_image_name }}
                            <i
                              (click)="importClipboard(mobile.mobile_image_name)"
                              [ngClass]="{ active: isIconActive[mobile.mobile_image_name] }"
                              class="material-icons copyClipboardIcon"
                              [color]="isIconActive[mobile.mobile_image_name] ? 'primary' : ''">
                              content_copy
                            </i>
                          </div>
                          <div
                            class="emulator-info"
                            *ngIf="runningContainer; else noCodeTemplate">
                            <i class="material-icons">code</i>
                            <strong>Mobile Code:</strong> {{ runningContainer.hostname }}
                            <i
                              (click)="importClipboard(runningContainer.hostname); $event.stopPropagation();"
                              [ngClass]="{ active: isIconActive[runningContainer.hostname] }"
                              class="material-icons copyClipboardIcon"
                              [color]="isIconActive[runningContainer.hostname] ? 'primary' : ''">
                              content_copy
                            </i>
                          </div>

                          <ng-template #noCodeTemplate>
                            <div class="emulator-info">
                              <i class="material-icons">code</i>
                              <strong>Mobile Code:</strong> Click on 'Start' to see the device code
                            </div>
                          </ng-template>

                          <div class="emulator-info">
                            <button
                              class="moreInfo"
                              matTooltip="Show more information"
                              matTooltipPosition="above"
                              mat-icon-button
                              [matMenuTriggerFor]="moreInfo">
                              <i class="material-icons">more_vert</i>
                            </button>
                            <strong class="moreInfoStrong">
                              More information
                            </strong>
                          </div>

                          <mat-menu #moreInfo="matMenu">
                            <mat-menu-item class="pop-up-info">

                              <mat-menu-item>
                                <i class="material-icons">info</i>
                                <strong>Device Name:</strong> {{ mobile.mobile_json.deviceName }}
                              </mat-menu-item>

                              <mat-menu-item>
                                <i class="material-icons">memory</i>
                                <strong>Architecture:</strong> {{ mobile.mobile_json.architecture }}
                              </mat-menu-item>

                              <mat-menu-item>
                                <i class="material-icons">phone_android</i>
                                <strong>Android Version:</strong> {{ mobile.mobile_json.android_version }}
                              </mat-menu-item>

                              <mat-menu-item>
                                <i class="material-icons">layers</i>
                                <strong>API Level:</strong> {{ mobile.mobile_json.api_level }}
                              </mat-menu-item>
                            </mat-menu-item>
                          </mat-menu>
                          <div
                            class="emulator-info">
                            <mat-icon
                              [matBadge]="runningContainer?.apk_file?.length"
                              class="get-app"
                              [matTooltip]="hasInstalledApks(runningContainer) ? getApkTooltipText(runningContainer) : ''"
                              matTooltipPosition="above">
                              [matTooltipDisabled]="!hasInstalledApks(runningContainer)"
                              file_download
                            </mat-icon>
                            <p
                              class="installedApp"
                              [matTooltip]="hasInstalledApks(runningContainer) ? getApkTooltipText(runningContainer) : ''"
                              [matTooltipDisabled]="!hasInstalledApks(runningContainer)"
                              matTooltipPosition="above">
                              Number installed Apps
                            </p>
                          </div>
                        </div>
                      </div>
                      <div
                      class="sharedEmulator">
                      <mat-slide-toggle
                        [matTooltip]="(runningContainer?.shared ? 'mobile_list.shared' : 'mobile_list.not_shared') | translate"
                        matTooltipPosition="above"
                        color="primary"
                        [ngClass]="{'disabled-toggle': runningContainer?.shared || !runningContainer?.shared}"
                        [disableRipple]="runningContainer?.shared || !runningContainer?.shared"
                        (change)="updateSharedStatus({checked: $event.checked}, mobile, runningContainer).subscribe()"
                        id="isShared_{{ mobile.mobile_id }}"
                        [disabled]="runningContainer?.isTerminating || (runningContainer?.service_status !== 'Running' && runningContainer?.service_status !== 'Stopped')"
                        [checked]="runningContainer?.shared">
                      </mat-slide-toggle>
                    </div>
                  </div>
                </div>
              </div>




            <div class="dialog-header">
              <h3 class="not-dialog-title">Shared Mobile Devices</h3>
            </div>
            <div class="mobiles">
              <!-- Iterate over shared containers list -->
              <div class="mobile" *ngFor="let container of sharedMobileContainers; trackBy: trackByContainerId">
                <div *ngLet="container.service_status == 'Running' as isRunning">
                  <p> {{ conatiner }}</p>
                  <!-- Shared device details -->
                  <div class="mobile-details-shared">
                    <!-- <h4>Shared Device Information</h4>
                    <mat-divider></mat-divider> -->
                    <div class="container-buttons-shared">
                      <div
                        class="container-novnc-left-shared">
                        <div
                          (click)="noVNCMobile(container, mobile)"
                          mat-raised-button
                          class="start-stop-inpect-buttons"
                          [disabled]="container.service_status !== 'Running'"
                          [matTooltip]="'mobile_list.inspect_novnc_shared' | translate"
                          matTooltipPosition="above">
                          <span class="inspect-text">noVNC</span>
                          <i class="material-icons icon-on-hover">visibility</i>
                        </div>
                        <div class="hideShadow"></div>
                      </div>

                      <div
                        class="container-inspect-left-shared">
                        <div
                          (click)="inspectMobile(container, container.image)"
                          mat-raised-button
                          class="start-stop-inpect-buttons"
                          [disabled]="container.service_status !== 'Running'"
                          [matTooltip]="'mobile_list.inspect_emulator_shared' | translate"
                          matTooltipPosition="above">
                          <span class="inspect-text">Inspect</span>
                          <i class="material-icons icon-on-hover">visibility</i>
                        </div>
                        <div class="hideShadow"></div>
                      </div>
                    </div>
                    <div class="mobile-information-shared">
                      <div class="emulator-info">
                        <i class="material-icons">adb</i>
                        <strong>Mobile Name:</strong>
                        {{ container.image.mobile_image_name }}
                        <i
                          (click)="importClipboard(container.image.mobile_image_name)"
                          [ngClass]="{ active: isIconActive[container.image.mobile_image_name] }"
                          class="material-icons copyClipboardIcon"
                          [color]="isIconActive[container.image.mobile_image_name] ? 'primary' : ''">
                          content_copy
                        </i>
                      </div>
                      <div class="emulator-info" *ngIf="isRunning">
                        <i class="material-icons">code</i>
                        <strong>Device Code:</strong>
                        {{ container.hostname }}
                        <i
                          (click)="importClipboard(container.hostname)"
                          [ngClass]="{ active: isIconActive }"
                          class="material-icons copyClipboardIcon"
                          [color]="isIconActive ? 'primary' : ''">
                          content_copy
                        </i>
                      </div>
                      <ng-container>
                        <div class="status-container">
                          <i class="material-icons">{{ isRunning ? 'check_circle' : 'highlight_off' }}</i>
                          <strong>Status:</strong>
                          <span [ngClass]="{ 'running-text': isRunning, 'stopped-text': !isRunning }">
                            {{ container.service_status}}
                          </span>
                          <span [ngClass]="{ 'running': isRunning, 'stopped': !isRunning }" class="status-circle"></span>
                        </div>
                      </ng-container>

                      <div class="emulator-info">
                        <button
                          class="moreInfoShared"
                          matTooltip="Show more information"
                          matTooltipPosition="above"
                          mat-icon-button
                          [matMenuTriggerFor]="moreInfo">
                          <i class="material-icons">more_vert</i>
                        </button>
                        <strong class="moreInfoStrongShared">
                          More information
                        </strong>
                      </div>

                      <mat-menu #moreInfo="matMenu">
                        <mat-menu-item class="pop-up-info">


                          <mat-menu-item>
                            <i class="material-icons">info</i>
                            <strong>Device Name:</strong> {{ container.image.mobile_json.deviceName }}
                          </mat-menu-item>

                          <mat-menu-item>
                            <i class="material-icons">memory</i>
                            <strong>Architecture:</strong> {{ container.image.mobile_json.architecture }}
                          </mat-menu-item>

                          <mat-menu-item>
                            <i class="material-icons">phone_android</i>
                            <strong>Android Version:</strong> {{ container.image.mobile_json.android_version }}
                          </mat-menu-item>

                          <mat-menu-item>
                            <i class="material-icons">layers</i>
                            <strong>API Level:</strong> {{ container.image.mobile_json.api_level }}
                          </mat-menu-item>
                        </mat-menu-item>
                      </mat-menu>
                    </div>
                  </div>
                </div>
                <div class="created-by">
                  <strong>Created by:</strong> {{ container.created_by_name }}
                </div>
              </div>
              <p *ngIf="sharedMobileContainers.length == 0" class="nonMobileShared">
                There are no shared mobiles available for you. You can ask your
                teammates to share their mobile emulators so you can collaborate on
                the same machine.
              </p>
            </div>
          </div>
        </div>
      </mat-dialog-content>
      <mat-dialog-actions>
        <button class="noDialogCloseButton" mat-stroked-button color="warn" mat-dialog-close>
          Close
        </button>
      </mat-dialog-actions>
    </div>














    <ng-template #notDialog>

      <div class="notDialog-landing">

        <div class="mobile-devices-header">
          <p>
            Found <span class="mobile-results"> {{ mobiles.length }} </span> mobile devices and <span class="mobile-results"> {{ sharedMobileContainers.length }} </span> shared mobile devices.
          </p>
        </div>

        <div class="columns-button-wrapper">
          <div class="container-father">
            <ng-container>
              <mat-form-field class="selectFormField">
                <mat-label><mat-icon>domain</mat-icon> Select Department</mat-label>
                <mat-select
                  [(ngModel)]="selectedDepartment"
                  (selectionChange)="onDepartmentSelect($event)"
                  [compareWith]="compareDepartments">

                  <mat-option
                    class="mobile-options"
                    *ngFor="let department of departments"
                    [value]="{ id: department.department_id, name: department.department_name }">
                    <mat-card>{{ department.department_name }}</mat-card>
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </ng-container>

            <div *ngIf="!selectedDepartment || selectedDepartment.name === ''" class="department-warning">
              <mat-icon>info</mat-icon>
              <span>
                Selecting a <strong>department</strong> will make the container buttons available for use.
              </span>
            </div>
          </div>
        </div>


        <div class="dialog-header">
          <h3 class="not-dialog-title">Mobile Devices</h3>
        </div>

        <div class="not-dialog-scrollable-content" *ngIf="selectedDepartment">
            <!-- <h2 mat-dialog-title>Mobile Devices</h2> -->
            <!-- Available Devices -->
            
            <!-- Mobile list view selector -->
            <div class="mobile-view-header">
              <div class="mobile-count" *ngIf="mobiles.length > 0">
                Found <span class="blue">{{ mobiles.length }}</span> mobile devices
              </div>
              <div class="view-selector">
                <div
                  matRipple
                  (click)="setView('with', 'tiles')"
                  matTooltip="Tiles view"
                  [class.selected]="mobileViewWith === 'tiles'"
                  class="tiles view"></div>
                <div
                  matRipple
                  (click)="setView('with', 'list')"
                  matTooltip="List view"
                  [class.selected]="mobileViewWith === 'list'"
                  class="list view"></div>
              </div>
            </div>
            
            <div class="devices">
              <!-- Mobile selection section -->
              
              <!-- Mobile tiles view -->
              <ng-container *ngIf="mobileViewWith === 'tiles'">
                <div class="mobile-selector-box">
                  <div class="mobiles">
                    <!-- Iterate over mobile containers list -->
                    <div class="mobile" *ngFor="let mobile of mobiles">
                    <div *ngLet="isThisMobileContainerRunning(mobile.mobile_id) as runningContainer">
                      <!-- In developement -->
                      <div class="container-buttons">
                        <div
                          class="container-inspect-left"
                          *ngIf="runningContainer; else notRunningTemplate">
                          <div
                            (click)="inspectMobile(runningContainer, mobile)"
                            mat-raised-button
                            class="start-stop-inpect-buttons"
                            [disabled]="runningContainer.isTerminating"

                            [matTooltip]="'mobile_list.inspect_emulator' | translate" matTooltipPosition="above">
                            <span class="inspect-text">Inspect</span>
                            <i class="material-icons icon-on-hover">visibility</i>
                          </div>
                          <div class="hideShadow"></div>
                        </div>
                        <div
                          class="container-novnc-left"
                          *ngIf="runningContainer; else notRunningTemplate">
                          <div
                            (click)="noVNCMobile(runningContainer, mobile)"
                            mat-raised-button
                            class="start-stop-inpect-buttons"

                            [matTooltip]="'mobile_list.inspect_novnc' | translate"
                            matTooltipPosition="above">
                            <span class="inspect-text">noVNC</span>
                            <i class="material-icons icon-on-hover">visibility</i>
                          </div>
                          <div class="hideShadow"></div>
                        </div>
                        <div
                          class="border-left-close"
                          *ngIf="runningContainer; else notRunningTemplate">
                          <div
                            [matTooltip]="'mobile_list.close_emulator' | translate"
                            matTooltipPosition="above"
                            mat-raised-button
                            color="warn"
                            class="close"
                            (click)="!runningContainer?.isTerminating && terminateMobile(runningContainer)"
                            [ngClass]="{ 'spinner-active': runningContainer?.isTerminating }">
                            <ng-container
                              *ngIf="!runningContainer?.isTerminating; else showSpinner">
                              <mat-icon class="close-icon">close</mat-icon>
                            </ng-container>

                            <ng-template #showSpinner>
                              <mat-spinner
                                class="spinner"
                                color="accent"
                                diameter="16">
                              </mat-spinner>
                            </ng-template>
                          </div>
                        </div>


                        <div class="border-left-start-restart"
                          [ngClass]="{ 'disabled-button-border': !selectedDepartment || !selectedDepartment.id }"
                          *ngIf="!runningContainer">
                          <div
                            (click)="startMobile(mobile.mobile_id) "
                            [disabled]="!selectionsDisabled"
                            [ngClass]="{ 'disabled-button': !selectedDepartment || !selectedDepartment.id }"
                            mat-raised-button
                            color="primary"
                            class="start">
                            Start
                          </div>
                        </div>

                        <ng-container *ngIf="runningContainer">
                          <div class="skewed-button-container"
                            [ngClass]="{
                              'restart-bg': runningContainer.service_status === 'Stopped' || runningContainer.service_status === 'Restarting',
                              'pause-bg': runningContainer.service_status === 'Running' || runningContainer.service_status === 'Stopping'
                            }">

                            <div
                              mat-raised-button
                              class="skewed-button"
                              (click)="handleMobileState(runningContainer)"
                              [disabled]="runningContainer.service_status === 'Restarting' || runningContainer.service_status === 'Stopping'"
                              [matTooltip]="
                              runningContainer.service_status === 'Running' ? 'Click to pause' :
                              (runningContainer.service_status === 'Stopped' ? 'Click to restart' : '')"
                              matTooltipPosition="above">

                              <ng-container *ngIf="runningContainer.service_status === 'Stopping' || runningContainer.service_status === 'Restarting'; else showIcon">
                                <mat-spinner
                                  class="spinnerPause"
                                  [color]="runningContainer.service_status === 'Restarting' ? 'warn' : 'primary'"
                                  diameter="16">
                                </mat-spinner>
                              </ng-container>

                              <ng-template #showIcon>
                                <i class="material-icons skewed-content">
                                  {{ runningContainer.service_status === 'Running' ? 'pause' : 'play_arrow' }}
                                </i>
                                <span class="skewed-content-span">
                                  {{ runningContainer.service_status === 'Running' ? 'Pause' : 'Restart' }}
                                </span>
                              </ng-template>

                            </div>
                          </div>
                        </ng-container>
                      </div>
                      <!-- Take it and put it above on the mobile div with X  -->
                      <!-- Popup a confirmation box to Yes/No -->

                      <ng-template #notRunningTemplate>
                        <div class="not-running">
                        </div>
                      </ng-template>

                      <!-- Button more vert (modify etc) -->
                      <div class="mobile-details">
                        <button
                          [matTooltip]="'mobile_list.emulator_options' | translate"
                          matTooltipPosition="after"
                          class="emulatorOptions"
                          mat-icon-button
                          [matMenuTriggerFor]="emulatorOptions">
                          <mat-icon>more_vert</mat-icon>
                        </button>

                        <mat-menu #emulatorOptions="matMenu">
                          <!-- Start -->
                          <button
                            (click)="startMobile(mobile.mobile_id)"
                            class="startMenu"
                            [disabled]="runningContainer"
                            [matTooltip]="'tooltips.run_feature' | translate"
                            matTooltipPosition="after"
                            mat-menu-item>
                            <mat-icon>play_circle_filled</mat-icon>
                            <span>Start</span>
                          </button>

                          <!-- Restart -->
                          <button
                            (click)="restartMobile(runningContainer)"
                            class="restartMenu"
                            [disabled]="
                              runningContainer?.service_status === 'Running' ||
                              runningContainer?.service_status === 'Restarting' ||
                              runningContainer?.service_status === 'Stopping' ||
                              !runningContainer"
                            mat-menu-item>
                            <img class="iconImgRestart" alt="Not started icon" src="assets/not_started.svg">
                            <span>Restart</span>
                          </button>

                          <!-- Pause -->
                          <button
                            (click)="pauseMobile(runningContainer)"
                            class="pauseMenu"
                            [disabled]="
                              runningContainer?.service_status === 'Stopped' ||
                              runningContainer?.service_status === 'Stopping' ||
                              runningContainer?.service_status === 'Restarting' ||
                              !runningContainer"
                            mat-menu-item>
                            <mat-icon>pause_circle_filled</mat-icon>
                            <span>Pause</span>
                          </button>

                          <mat-divider></mat-divider>

                          <!-- Modify -->
                          <button
                            [disabled]="runningContainer?.service_status !== 'Running'"
                            [matTooltip]="(runningContainer?.service_status !== 'Running'
                            ? 'mobile_list.modify_emulator_not_started'
                            : 'mobile_list.modify_emulator_started') | translate"
                            matTooltipPosition="after"
                            (click)="openModifyEmulatorDialog(mobile, runningContainer)"
                            class="modifyMenu"
                            mat-menu-item>
                            <mat-icon>edit</mat-icon>
                            <span>Modify</span>
                          </button>

                          <mat-divider></mat-divider>

                          <!-- Close -->
                          <button
                            (click)="terminateMobile(runningContainer)"
                            class="closeMenu"
                            [disabled]="!runningContainer"
                            mat-menu-item>
                            <mat-icon class="close-icon">cancel</mat-icon>
                            <span class="modifySpan">Close</span>
                          </button>
                        </mat-menu>

                        <div class="mobile-information">
                          <div class="emulator-info">
                            <i class="material-icons">adb</i>
                            <strong>Mobile Name:</strong>
                            {{ mobile.mobile_image_name }}
                            <i
                              (click)="importClipboard(mobile.mobile_image_name)"
                              [ngClass]="{ active: isIconActive[mobile.mobile_image_name] }"
                              class="material-icons copyClipboardIcon"
                              [color]="isIconActive[mobile.mobile_image_name] ? 'primary' : ''">
                              content_copy
                            </i>
                          </div>
                          <div
                            class="emulator-info"
                            *ngIf="runningContainer; else noCodeTemplate">
                            <i class="material-icons">code</i>
                            <strong>Mobile Code:</strong> {{ runningContainer.hostname }}
                            <i
                              (click)="importClipboard(runningContainer.hostname); $event.stopPropagation();"
                              [ngClass]="{ active: isIconActive[runningContainer.hostname] }"
                              class="material-icons copyClipboardIcon"
                              [color]="isIconActive[runningContainer.hostname] ? 'primary' : ''">
                              content_copy
                            </i>
                          </div>

                          <ng-template #noCodeTemplate>
                            <div class="emulator-info">
                              <i class="material-icons">code</i>
                              <strong>Mobile Code:</strong> Click on 'Start' to see the device code
                            </div>
                          </ng-template>

                          <div class="emulator-info">
                            <button
                              class="moreInfo"
                              matTooltip="Show more information"
                              matTooltipPosition="above"
                              mat-icon-button
                              [matMenuTriggerFor]="moreInfo">
                              <i class="material-icons">more_vert</i>
                            </button>
                            <strong class="moreInfoStrong">
                              More information
                            </strong>
                          </div>

                          <mat-menu #moreInfo="matMenu">
                            <mat-menu-item class="pop-up-info">

                              <mat-menu-item>
                                <i class="material-icons">info</i>
                                <strong>Device Name:</strong> {{ mobile.mobile_json.deviceName }}
                              </mat-menu-item>

                              <mat-menu-item>
                                <i class="material-icons">memory</i>
                                <strong>Architecture:</strong> {{ mobile.mobile_json.architecture }}
                              </mat-menu-item>

                              <mat-menu-item>
                                <i class="material-icons">phone_android</i>
                                <strong>Android Version:</strong> {{ mobile.mobile_json.android_version }}
                              </mat-menu-item>

                              <mat-menu-item>
                                <i class="material-icons">layers</i>
                                <strong>API Level:</strong> {{ mobile.mobile_json.api_level }}
                              </mat-menu-item>
                            </mat-menu-item>
                          </mat-menu>
                          <div
                            class="emulator-info">
                            <mat-icon
                              [matBadge]="runningContainer?.apk_file?.length"
                              class="get-app"
                              [matTooltip]="hasInstalledApks(runningContainer) ? getApkTooltipText(runningContainer) : ''"
                              [matTooltipDisabled]="!hasInstalledApks(runningContainer)"
                              matTooltipPosition="above">
                              file_download
                            </mat-icon>
                            <p
                              class="installedApp"
                              [matTooltip]="hasInstalledApks(runningContainer) ? getApkTooltipText(runningContainer) : ''"
                              [matTooltipDisabled]="!hasInstalledApks(runningContainer)"
                              matTooltipPosition="above">
                              Number installed Apps

                            </p>
                          </div>
                        </div>
                      </div>
                      <div
                        class="sharedEmulator">
                        <mat-slide-toggle
                          [matTooltip]="(runningContainer?.shared ? 'mobile_list.shared' : 'mobile_list.not_shared') | translate"
                          matTooltipPosition="above"
                          color="primary"
                          [ngClass]="{'disabled-toggle': runningContainer?.shared || !runningContainer?.shared}"
                          [disableRipple]="runningContainer?.shared || !runningContainer?.shared"
                          (change)="updateSharedStatus({checked: $event.checked}, mobile, runningContainer).subscribe()"                     
                          id="isShared_{{ mobile.mobile_id }}"
                          [disabled]="runningContainer?.isTerminating || (runningContainer?.service_status !== 'Running' && runningContainer?.service_status !== 'Stopped')"
                          [checked]="runningContainer?.shared">
                        </mat-slide-toggle>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Shared Mobile Devices Section (only in tiles view) -->
                <div class="shared-mobile-section" *ngIf="sharedMobileContainers.length > 0">
                  <div class="dialog-header">
                    <h3 class="not-dialog-title">Shared Mobile Devices</h3>
                  </div>
                  <div class="mobiles">
                    <!-- Iterate over shared containers list -->
                    <div class="mobile" *ngFor="let container of sharedMobileContainers; trackBy: trackByContainerId">
                      <div *ngLet="container.service_status == 'Running' as isRunning">
                        <!-- Shared device details -->
                        <div class="mobile-details-shared">
                          <!-- <h4>Shared Device Information</h4>
                          <mat-divider></mat-divider> -->
                          <div class="container-buttons-shared">
                            <div
                              class="container-novnc-left-shared">
                              <div
                                (click)="noVNCMobile(container, mobile)"
                                mat-raised-button
                                class="start-stop-inpect-buttons"
                                [disabled]="container.service_status !== 'Running'"
                                [matTooltip]="'mobile_list.inspect_novnc_shared' | translate"
                                matTooltipPosition="above">
                                <span class="inspect-text">noVNC</span>
                                <i class="material-icons icon-on-hover">visibility</i>
                              </div>
                              <div class="hideShadow"></div>
                            </div>

                            <div
                              class="container-inspect-left-shared">
                              <div
                                (click)="inspectMobile(container, container.image)"
                                mat-raised-button
                                class="start-stop-inpect-buttons"
                                [disabled]="container.service_status !== 'Running'"
                                [matTooltip]="'mobile_list.inspect_emulator_shared' | translate"
                                matTooltipPosition="above">
                                <span class="inspect-text">Inspect</span>
                                <i class="material-icons icon-on-hover">visibility</i>
                              </div>
                              <div class="hideShadow"></div>
                            </div>
                          </div>
                          <div class="mobile-information-shared">
                            <div class="emulator-info">
                              <i class="material-icons">adb</i>
                              <strong>Mobile Name:</strong>
                              {{ container.image.mobile_image_name }}
                              <i
                                (click)="importClipboard(container.image.mobile_image_name)"
                                [ngClass]="{ active: isIconActive[container.image.mobile_image_name] }"
                                class="material-icons copyClipboardIcon"
                                [color]="isIconActive[container.image.mobile_image_name] ? 'primary' : ''">
                                content_copy
                              </i>
                            </div>
                            <div class="emulator-info">
                              <i class="material-icons">code</i>
                              <strong>Device Code:</strong>
                              {{ container.hostname }}
                              <i
                                (click)="importClipboard(container.hostname)"
                                [ngClass]="{ active: isIconActive }"
                                class="material-icons copyClipboardIcon"
                                [color]="isIconActive ? 'primary' : ''">
                                content_copy
                              </i>
                            </div>
                            <div>
                              <div class="status-container">
                                <i class="material-icons">{{ isRunning ? 'check_circle' : 'highlight_off' }}</i>
                                <strong>Status:</strong>
                                <span [ngClass]="{ 'running-text': isRunning, 'stopped-text': !isRunning }">
                                  {{ container.service_status}}
                                </span>
                                <span [ngClass]="{ 'running': isRunning, 'paused': !isRunning }" class="status-circle"></span>
                              </div>
                            </div>

                            <div class="emulator-info">
                              <button
                                class="moreInfoShared"
                                matTooltip="Show more information"
                                matTooltipPosition="above"
                                mat-icon-button
                                [matMenuTriggerFor]="moreInfo">
                                <i class="material-icons">more_vert</i>
                              </button>
                              <strong class="moreInfoStrongShared">
                                More information
                              </strong>
                            </div>

                            <mat-menu #moreInfo="matMenu">
                              <mat-menu-item class="pop-up-info">
                                <mat-menu-item>
                                  <i class="material-icons">info</i>
                                  <strong>Device Name:</strong> {{ container.image.mobile_json.deviceName }}
                                </mat-menu-item>

                                <mat-menu-item>
                                  <i class="material-icons">memory</i>
                                  <strong>Architecture:</strong> {{ container.image.mobile_json.architecture }}
                                </mat-menu-item>

                                <mat-menu-item>
                                  <i class="material-icons">phone_android</i>
                                  <strong>Android Version:</strong> {{ container.image.mobile_json.android_version }}
                                </mat-menu-item>

                                <mat-menu-item>
                                  <i class="material-icons">layers</i>
                                  <strong>API Level:</strong> {{ container.image.mobile_json.api_level }}
                                </mat-menu-item>
                              </mat-menu-item>
                            </mat-menu>
                          </div>
                        </div>
                      </div>
                      <div class="created-by">
                        <strong>Created by:</strong> {{ container.created_by_name }}
                      </div>
                    </div>
                    <p *ngIf="sharedMobileContainers.length == 0" class="nonMobileShared">
                      There are no shared mobiles available for you. You can ask your
                      teammates to share their mobile emulators so you can collaborate on
                      the same machine.
                    </p>
                  </div>
                </div>
              </ng-container>
              <!-- Mobile list view -->
              <ng-container *ngIf="mobileViewWith === 'list'">
                <div class="mobile-list-view">
                  <div class="mobile-list-item" *ngFor="let mobile of mobiles">
                    <div *ngLet="isThisMobileContainerRunning(mobile.mobile_id) as runningContainer">
                      <div class="mobile-list-content">
                        <div class="mobile-info">
                          <div class="mobile-name">
                            <i class="material-icons mobile-icon">phone_android</i>
                            <span>{{ mobile.mobile_image_name }}</span>
                          </div>
                          <div class="mobile-details">
                            <span class="device-name">{{ mobile.mobile_json.deviceName }}</span>
                            <span class="android-version">Android {{ mobile.mobile_json.android_version }}</span>
                            <span class="api-level">API {{ mobile.mobile_json.api_level }}</span>
                          </div>
                        </div>
                        
                        <div class="mobile-actions">
                          <div class="action-buttons">
                            <button
                              *ngIf="runningContainer"
                              (click)="inspectMobile(runningContainer, mobile)"
                              mat-raised-button
                              class="action-button inspect"
                              [disabled]="runningContainer.isTerminating"
                              [matTooltip]="'mobile_list.inspect_emulator' | translate">
                              <mat-icon>visibility</mat-icon>
                              Inspect
                            </button>
                            
                            <button
                              *ngIf="runningContainer"
                              (click)="noVNCMobile(runningContainer, mobile)"
                              mat-raised-button
                              class="action-button novnc"
                              [matTooltip]="'mobile_list.inspect_novnc' | translate">
                              <mat-icon>visibility</mat-icon>
                              noVNC
                            </button>
                            
                            <button
                              *ngIf="!runningContainer"
                              (click)="startMobile(mobile.mobile_id)"
                              mat-raised-button
                              color="primary"
                              class="action-button start"
                              [disabled]="!selectedDepartment || !selectedDepartment.id"
                              [matTooltip]="'mobile_list.start_emulator' | translate">
                              <mat-icon>play_arrow</mat-icon>
                              Start
                            </button>
                            
                            <button
                              *ngIf="runningContainer"
                              (click)="!runningContainer?.isTerminating && terminateMobile(runningContainer)"
                              mat-raised-button
                              color="warn"
                              class="action-button close"
                              [disabled]="runningContainer?.isTerminating"
                              [matTooltip]="'mobile_list.close_emulator' | translate">
                              <mat-icon>close</mat-icon>
                              Close
                            </button>
                          </div>
                          
                          <div class="mobile-status" *ngIf="runningContainer">
                            <span class="status-badge running" *ngIf="runningContainer.service_status === 'Running'">
                              <mat-icon>check_circle</mat-icon>
                              Running
                            </span>
                            <span class="status-badge stopped" *ngIf="runningContainer.service_status === 'Stopped'">
                              <mat-icon>pause_circle</mat-icon>
                              Stopped
                            </span>
                            <span class="status-badge terminating" *ngIf="runningContainer.isTerminating">
                              <mat-spinner diameter="16"></mat-spinner>
                              Terminating
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>

              <!-- Shared Mobile Devices Section (only in list view) -->
              <ng-container *ngIf="mobileViewWith === 'list' && sharedMobileContainers.length > 0">
                <div class="shared-mobile-section">
                  <div class="dialog-header">
                    <h3 class="not-dialog-title">Shared Mobile Devices</h3>
                  </div>
                  <div class="mobile-list-view">
                    <div class="mobile-list-item" *ngFor="let container of sharedMobileContainers; trackBy: trackByContainerId">
                      <div *ngLet="container.service_status == 'Running' as isRunning">
                        <div class="mobile-list-content">
                          <div class="mobile-info">
                            <div class="mobile-name">
                              <i class="material-icons mobile-icon">phone_android</i>
                              <span>{{ container.image.mobile_image_name }}</span>
                              <span class="shared-badge">Shared</span>
                            </div>
                            <div class="mobile-details">
                              <span class="device-name">{{ container.image.mobile_json.deviceName }}</span>
                              <span class="android-version">Android {{ container.image.mobile_json.android_version }}</span>
                              <span class="api-level">API {{ container.image.mobile_json.api_level }}</span>
                              <span class="created-by">Created by: {{ container.created_by_name }}</span>
                            </div>
                          </div>
                          
                          <div class="mobile-actions">
                            <div class="action-buttons">
                              <button
                                *ngIf="isRunning"
                                (click)="inspectMobile(container, container.image)"
                                mat-raised-button
                                class="action-button inspect"
                                [disabled]="container.service_status !== 'Running'"
                                [matTooltip]="'mobile_list.inspect_emulator_shared' | translate">
                                <mat-icon>visibility</mat-icon>
                                Inspect
                              </button>
                              
                              <button
                                *ngIf="isRunning"
                                (click)="noVNCMobile(container, container.image)"
                                mat-raised-button
                                class="action-button novnc"
                                [disabled]="container.service_status !== 'Running'"
                                [matTooltip]="'mobile_list.inspect_novnc_shared' | translate">
                                <mat-icon>visibility</mat-icon>
                                noVNC
                              </button>
                            </div>
                            
                            <div class="mobile-status">
                              <span class="status-badge running" *ngIf="isRunning">
                                <mat-icon>check_circle</mat-icon>
                                Running
                              </span>
                              <span class="status-badge stopped" *ngIf="!isRunning">
                                <mat-icon>pause_circle</mat-icon>
                                Stopped
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>

            </div>
        </div>
      </div>
    </ng-template>
  </ng-template>
</div>
