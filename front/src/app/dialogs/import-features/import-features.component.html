<h2 mat-dialog-title>Import Feature(s)</h2>
<div mat-dialog-content class="content import-features">
  <div class="mode-bar">
    <div class="toggles">
      <button mat-button [class.active]="mode === 'file'" (click)="setMode('file')">
        Upload file
      </button>
      <button mat-button [class.active]="mode === 'paste'" (click)="setMode('paste')">
        Paste JSON
      </button>
    </div>
    <button mat-button class="clear" (click)="clear()" *ngIf="hasItems">
      <mat-icon>clear</mat-icon>
      Clear list
    </button>
  </div>
  <div class="instructions mat-body-2">
    1. Choose a source above (toggle between Upload or Paste) and load your JSON export.<br />
    2. Review detected features: edit names, add browsers when needed, or leave inherited ones for dependencies.<br />
    3. Select the feature(s) you want and press Save to import.
  </div>
  <div class="location-controls" *ngIf="departments.length > 0">
    <mat-form-field appearance="outline">
      <mat-label>Department</mat-label>
      <mat-select [(ngModel)]="selectedDepartmentId" (selectionChange)="onDepartmentChange($event.value)">
        <mat-option *ngFor="let dept of departments" [value]="dept.department_id">
          {{ dept.department_name }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Folder</mat-label>
      <mat-select [(ngModel)]="selectedFolderId">
        <mat-option [value]="0">Department root</mat-option>
        <mat-option *ngFor="let option of folderOptions" [value]="option.id">
          {{ option.label }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <div class="file-picker" *ngIf="mode === 'file'">
    <label class="upload">
      <input type="file" accept="application/json" (change)="onFileSelected($event)" />
      <span class="btn">Choose File</span>
      <span class="file-name" *ngIf="lastFileName">{{ lastFileName }}</span>
    </label>
  </div>
  <div class="paste-container" *ngIf="mode === 'paste'">
    <button mat-stroked-button class="paste" (click)="openPasteDialog()">
      <mat-icon>content_paste</mat-icon>
      Open paste dialog
    </button>
    <span class="hint">Paste raw JSON to replace the current list.</span>
  </div>

  <div *ngIf="currentParseError" class="inline-error">{{ currentParseError }}</div>

  <cometa-import-features-table
    *ngIf="hasItems"
    [items]="currentItems"
    [allSelected]="currentAllSelected"
    [browsersLabel]="browsersLabel.bind(this)"
    [requiresBrowsers]="requiresBrowsers.bind(this)"
    [browserTooltip]="browserTooltip.bind(this)"
    (selectAllChange)="toggleSelectAll($event)"
    (selectionChange)="onItemSelectionChange($event.item, $event.selected)"
    (nameChange)="onNameChange($event.item, $event.name)"
    (addDefaultBrowsers)="setDefaultBrowsers($event)">
  </cometa-import-features-table>
</div>
<mat-dialog-actions>
  <div class="actions-right">
    <button
      type="button"
      color="warn"
      [disabled]="busy"
      mat-stroked-button
      (click)="handleCancel()">
      CANCEL
    </button>
    <button
      type="button"
      color="primary"
      [disabled]="busy || !hasItems"
      mat-stroked-button
      (click)="importSelected()">
      SAVE
    </button>
  </div>
</mat-dialog-actions>
