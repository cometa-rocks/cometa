<div class="info-row" *ngLet="status$ | async as status">
  <div class="index">{{ index + 1 }}</div>
  <div
    class="icon-status"
    [ngClass]="status"
    [matTooltip]="status | titlecase"
    matTooltipPosition="above"></div>
  <div class="text" [matTooltip]="step.step_content" matTooltipPosition="above">
    <div class="step-content">
      {{ step.step_keyword }} {{ step.step_content | truncateApiBody }}
    </div>
    <div
      class="step-detail"
      [@detailAnimation]
      *ngIf="status === 'running' && details$ | async as detail">
      <div class="icon-detail"></div>
      {{ detail }}
    </div>
    <div
      class="healing-details"
      [@healingDetailsAnimation]
      *ngIf="showHealingDetails && (healingData$ | async) as healingData">
      <div class="healing-detail-row">
        <mat-icon class="healing-icon">error_outline</mat-icon>
        <span class="healing-label">Original selector failed:</span>
        <code class="selector-code">{{ healingData.original_selector }}</code>
      </div>
      <div class="healing-detail-row">
        <mat-icon class="healing-icon">check_circle</mat-icon>
        <span class="healing-label">New selector used:</span>
        <code class="selector-code">{{ healingData.healed_selector }}</code>
      </div>
      <div class="healing-detail-row">
        <mat-icon class="healing-icon">speed</mat-icon>
        <span class="healing-label">Confidence:</span>
        <span>{{ healingData.confidence_score }}%</span>
      </div>
      <div class="healing-detail-row">
        <mat-icon class="healing-icon">timer</mat-icon>
        <span class="healing-label">Healing time:</span>
        <span>+{{ healingData.healing_duration_ms }}ms</span>
      </div>
      <div class="healing-detail-row">
        <mat-icon class="healing-icon">build</mat-icon>
        <span class="healing-label">Method:</span>
        <span>{{ healingData.healing_method }}</span>
      </div>
    </div>
  </div>
  <div
    class="screenshot"
    *ngIf="
      (steps$ | async)[index]?.screenshot || screenshots?.current;
      else hyphen
    ">
    <i
      class="screen-image"
      *ngIf="status == 'running' || status == 'waiting'; else showBefore"
      [ngClass]="status"></i>
    <ng-template #showBefore>
      <i
        class="screen-preview"
        matTooltip="View screenshot"
        matTooltipPosition="above"
        (click)="openScreenshot('current')"
        [style.backgroundImage]="getScreenshot('current')"></i>
    </ng-template>
  </div>
  <div class="screenshot" *ngIf="(steps$ | async)[index]?.compare; else hyphen">
    <i
      class="screen-image"
      *ngIf="status != 'success'; else showBefore"
      [ngClass]="status"></i>
    <ng-template #showBefore>
      <i
        class="screen-preview"
        matTooltip="View screenshot"
        matTooltipPosition="above"
        (click)="openScreenshot('template')"
        [style.backgroundImage]="getScreenshot('template')"></i>
    </ng-template>
  </div>
  <div class="screenshot" *ngIf="(steps$ | async)[index]?.compare; else hyphen">
    <i
      class="screen-image"
      *ngIf="status != 'success'; else showBefore"
      [ngClass]="status"></i>
    <ng-template #showBefore>
      <i
        class="screen-preview"
        matTooltip="View screenshot"
        matTooltipPosition="above"
        (click)="openScreenshot('difference')"
        [style.backgroundImage]="getScreenshot('difference')"></i>
    </ng-template>
  </div>
  <div class="screenshot others-column">
    <ng-container *ngIf="rest_api || vulnerable_headers_count || (healingData$ | async); else othersHyphen">
      <i
        class="api_call"
        *ngIf="rest_api"
        matTooltip="View HTTP Request"
        matTooltipPosition="above"
        (click)="openRequest()">
        <mat-icon>http</mat-icon>
      </i>
      <i
        class="api_call"
        *ngIf="vulnerable_headers_count"
        matTooltip="Security Vulnerability | {{
          vulnerable_headers_count
        }} Requests response has vulnerable headers values, refer to execution reports for details"
        matTooltipPosition="above">
        <mat-icon [ngStyle]="{ color: 'red' }">report_problem</mat-icon>
      </i>
      <mat-icon 
        *ngIf="healingData$ | async as healingData"
        class="healing-icon"
        [matTooltip]="getHealingTooltip(healingData)"
        matTooltipPosition="above"
        (click)="toggleHealingDetails(); $event.stopPropagation()">
        healing
      </mat-icon>
    </ng-container>
    <ng-template #othersHyphen>
      <span class="hyphen-placeholder">-</span>
    </ng-template>
  </div>
  <ng-template #hyphen>
    <div class="screenshot">
      <span class="hyphen-placeholder">-</span>
    </div>
  </ng-template>
</div>
<div class="error-row" *ngIf="error$ | async as error">
  <div class="error-header">Error Details:</div>
  <div class="error-message">{{ error }}</div>
</div>
